---
title: "Prática em R"
subtitle: "Contrastando hipóteses: da formulação de modelos à atualização do conhecimento"
author: 
  - "Prof. Fabio Cop (*fcferreira@unifesp.br*)"
  - "Instituto do Mar - Unifesp"
date: today
lang: pt-BR
language:
  title-block-author-single: ""
  title-block-author-plural: ""
format:
  html:

    toc: true
    toc-title: "Conteúdo"
    toc-depth: 2
    number-sections: true
    embed-resources: true
    code-fold: false
    code-tools: true
  pdf:
    documentclass: article
    papersize: a4
    geometry:
      - margin=2.5cm
    toc: true
    toc-title: "Conteúdo"
    toc-depth: 2
    number-sections: true
    colorlinks: true
    include-in-header:
      text: |
        \usepackage{authblk}
---

{{< pagebreak >}}

::: {.callout-note appearance="minimal"}
**Curso:** Bacharelado Interdisciplinar em Ciências do Mar  
**Unidade Curricular (UC):** Probabilidade e Estatística  
**Atividade:** Prática no Laboratório de Informática  
**Duração:** 30 minutos
:::

::: {.callout-important appearance="minimal" title="Instruções"}

1. **Copie e execute o código**
2. **Observe** os resultados que aparecem
3. **Responda** às perguntas no documento que você vai entregar
4. **Entrega:** Acesse o Moodle e adicione suas respostas às perguntas abaixo
5. **Prazo:** Final da aula de hoje
:::

# Preparação: Carregando os Dados da Turma

Carregue os dados coletados no início da aula (dado mental e dado físico) para começar a análise.

### *Código* {-}

```{r}
#| eval: false

# Carregar os dados do arquivo CSV
dados <- read.csv("/caminhodoarquivo/dados_turma_aula1.csv")

# Separar os dados em dois vetores
mental <- dados$dado_mental
fisico <- dados$dado_fisico

# Contar quantas observações temos
n_mental <- length(mental)
n_fisico <- length(fisico)

# Mostrar os primeiros valores
print("Primeiras respostas - Dado Mental:")
head(mental, 10)

print("Primeiras respostas - Dado Físico:")
head(fisico, 10)

print(paste("Total de observações (dado mental):", n_mental))
print(paste("Total de observações (dado físico):", n_fisico))
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- O R carregou o arquivo CSV com sucesso.
- Você vê os primeiros 10 números do dado mental (valores de 1 a 6).
- Você vê os primeiros 10 números do dado físico (valores de 1 a 6).
- Aparece o total de observações de cada experimento.

:::


# Reproduzindo a Análise da Aula

Refaça os mesmos passos mostrados em sala: calcular frequências, fazer gráficos e calcular as verossimilhanças de H₁ e H₂.

## Calculando as Frequências

### *Código* {-}

```{r}
#| eval: false

# Contar quantas vezes cada face apareceu
freq_mental <- table(factor(mental, levels = 1:6))
freq_fisico <- table(factor(fisico, levels = 1:6))

# Mostrar as contagens
print("Frequências absolutas - Dado Mental:")
freq_mental

print("Frequências absolutas - Dado Físico:")
freq_fisico

# Calcular as proporções (dividir pelo total)
prop_mental <- freq_mental / n_mental
prop_fisico <- freq_fisico / n_fisico

print("Proporções - Dado Mental:")
round(prop_mental, 3)

print("Proporções - Dado Físico:")
round(prop_fisico, 3)
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- As **frequências absolutas** mostram quantas vezes cada face (1, 2, 3, 4, 5, 6) apareceu.
- As **proporções** mostram a porcentagem de cada face (valores entre 0 e 1).
- Compare mentalmente: alguma face apareceu muito mais que as outras?

:::

## Visualizando os Dados com Gráficos

### *Código* {-}

```{r}
#| eval: false

# Configurar para mostrar dois gráficos lado a lado
par(mfrow = c(1, 2))

# Gráfico do dado físico
barplot(prop_fisico, 
        col = "seagreen", 
        main = "Dado Físico",
        xlab = "Face", 
        ylab = "Proporção", 
        ylim = c(0, 0.35))
abline(h = 1/6, lty = 2, col = "red", lwd = 2)

# Gráfico do dado mental
barplot(prop_mental, 
        col = "steelblue", 
        main = "Dado Mental",
        xlab = "Face", 
        ylab = "Proporção", 
        ylim = c(0, 0.35))
abline(h = 1/6, lty = 2, col = "red", lwd = 2)
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- Você deve ver **dois gráficos de barras** lado a lado.
- A **linha vermelha tracejada** marca 1/6 = 0.167 (o esperado se o dado fosse uniforme).
- Compare os dois gráficos: qual deles parece mais próximo da linha vermelha?

:::

::: {.callout-important appearance="default" icon="false"}

### **PERGUNTA 1** {-}

Olhando para os dois gráficos:

a) O dado físico parece seguir uma distribuição uniforme (todas as faces com proporção próxima de 1/6)? Justifique.

b) O dado mental parece seguir uma distribuição uniforme? Quais faces aparecem mais ou menos que o esperado?

:::

## Calculando as Verossimilhanças

### *Código* {-}

```{r}
#| eval: false

# Definir as probabilidades de cada modelo
p_h1 <- rep(1/6, 6)  # H₁: todas as faces com prob = 1/6
p_h2 <- c(1, 2, 4, 4, 2, 1) / 14  # H₂: viés central

# Ver as probabilidades de H₂
print("Probabilidades do modelo H₂:")
round(p_h2, 3)

# Calcular log-verossimilhança de H₁ para o dado físico
loglik_H1_fisico <- sum(freq_fisico * log(p_h1))

# Calcular log-verossimilhança de H₂ para o dado físico
loglik_H2_fisico <- sum(freq_fisico * log(p_h2))

# Calcular log-verossimilhança de H₁ para o dado mental
loglik_H1_mental <- sum(freq_mental * log(p_h1))

# Calcular log-verossimilhança de H₂ para o dado mental
loglik_H2_mental <- sum(freq_mental * log(p_h2))

# Mostrar os resultados
print("=== DADO FÍSICO ===")
print(paste("Log-verossimilhança H₁:", round(loglik_H1_fisico, 2)))
print(paste("Log-verossimilhança H₂:", round(loglik_H2_fisico, 2)))

print("=== DADO MENTAL ===")
print(paste("Log-verossimilhança H₁:", round(loglik_H1_mental, 2)))
print(paste("Log-verossimilhança H₂:", round(loglik_H2_mental, 2)))
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- Você vê os valores de log-verossimilhança (números negativos).
- Valores **menos negativos** = maior verossimilhança = modelo mais compatível com os dados.
- Compare H₁ vs H₂ para cada experimento.

:::

## Comparando Modelos com Razão de Verossimilhanças

### *Código* {-}

```{r}
#| eval: false

# Calcular a razão H₂/H₁ para cada experimento
razao_fisico <- exp(loglik_H2_fisico - loglik_H1_fisico)
razao_mental <- exp(loglik_H2_mental - loglik_H1_mental)

print("=== RAZÃO DE VEROSSIMILHANÇAS (H₂/H₁) ===")
print(paste("Dado Físico:", round(razao_fisico, 2)))
print(paste("Dado Mental:", round(razao_mental, 2)))
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- A **razão de verossimilhanças** compara os dois modelos.
- Se a razão > 1: H₂ é mais verossímil que H₁.
- Se a razão < 1: H₁ é mais verossímil que H₂.
- Quanto maior o número, mais forte é a evidência.

:::

::: {.callout-important appearance="default" icon="false"}

### **PERGUNTA 2** {-}

a) Para o dado físico, qual hipótese (H₁ ou H₂) é mais compatível com os dados? Por quê?

b) Para o dado mental, qual hipótese é mais compatível? A diferença é grande?

:::

## Teste a Independência de H₁ dos Dados

### *Código* {-}

```{r}
#| eval: false

# Vamos criar dados fictícios diferentes, mas com o MESMO total
dados_equilibrados <- c(rep(1, 8), rep(2, 9), rep(3, 8), 
                        rep(4, 9), rep(5, 8), rep(6, 8))

dados_extremos <- c(rep(1, 25), rep(2, 0), rep(3, 0), 
                    rep(4, 0), rep(5, 0), rep(6, 25))

# Ambos têm n = 50 observações
n_teste <- 50

# Calcular verossimilhança de H₁ para os dois casos
freq_eq <- table(factor(dados_equilibrados, levels = 1:6))
freq_ex <- table(factor(dados_extremos, levels = 1:6))

loglik_H1_equilibrado <- sum(freq_eq * log(p_h1))
loglik_H1_extremo <- sum(freq_ex * log(p_h1))

print("=== TESTE: H₁ É CEGO AO PADRÃO? ===")
print(paste("H₁ para dados equilibrados:", round(loglik_H1_equilibrado, 2)))
print(paste("H₁ para dados extremos:", round(loglik_H1_extremo, 2)))
print(paste("São iguais?", 
            round(loglik_H1_equilibrado, 2) == round(loglik_H1_extremo, 2)))
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- Os dois conjuntos de dados são **completamente diferentes**.
- Mas a verossimilhança de H₁ é **exatamente a mesma**.
- Isso confirma que H₁ só depende do total de observações, não do padrão.

:::

::: {.callout-important appearance="default" icon="false"}

### **PERGUNTA 3** {-}

Com base neste teste, explique por que precisamos de pelo menos **duas hipóteses** para avaliar modelos. O que aconteceria se só tivéssemos H₁?

:::

# Simular e Calibrar

Simule 1000 "turmas virtuais" sob H₁ e verifique onde nossos dados reais se encaixam nessa distribuição de simulações.

## Simulando sob H₁

### *Código* {-}

```{r}
#| eval: false

# Número de simulações
n_sim <- 1000

# Vetor para guardar as razões de verossimilhança
razoes_simuladas <- numeric(n_sim)

# Loop: para cada simulação...
for (i in 1:n_sim) {
  # Simular uma turma sob H₁ (dado justo)
  amostra_sim <- sample(1:6, n_mental, replace = TRUE, prob = p_h1)
  
  # Calcular frequências
  freq_sim <- table(factor(amostra_sim, levels = 1:6))
  
  # Calcular log-verossimilhanças
  loglik_H1_sim <- sum(freq_sim * log(p_h1))
  loglik_H2_sim <- sum(freq_sim * log(p_h2))
  
  # Guardar a razão
  razoes_simuladas[i] <- exp(loglik_H2_sim - loglik_H1_sim)
}

print("Simulação concluída!")
print(paste("Média das razões simuladas:", round(mean(razoes_simuladas), 2)))
print(paste("Desvio padrão:", round(sd(razoes_simuladas), 2)))
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- O R simulou 1000 turmas onde **todos** os dados vêm de um dado justo (H₁).
- Para cada turma simulada, calculamos a razão H₂/H₁.
- A média nos diz qual razão é "típica" quando H₁ é verdadeiro.

:::

## Visualizando as Simulações

### *Código* {-}

```{r}
#| eval: false

# Fazer o histograma das razões simuladas
hist(razoes_simuladas, 
     breaks = 30, 
     col = "lightblue", 
     main = "Distribuição de H₂/H₁ sob simulações de H₁",
     xlab = "Razão de Verossimilhança (H₂/H₁)",
     ylab = "Frequência")

# Marcar onde caiu o dado físico
abline(v = razao_fisico, col = "green", lwd = 3, lty = 2)
text(razao_fisico, 100, "Dado Físico", pos = 4, col = "green")

# Marcar onde caiu o dado mental
abline(v = razao_mental, col = "red", lwd = 3, lty = 2)
text(razao_mental, 120, "Dado Mental", pos = 4, col = "red")

# Marcar a linha de 1 (onde H₁ e H₂ têm mesma verossimilhança)
abline(v = 1, col = "black", lwd = 2)
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- O **histograma azul** mostra as razões quando geramos dados de um dado justo.
- A **linha verde** marca onde caiu o dado físico da nossa turma.
- A **linha vermelha** marca onde caiu o dado mental da nossa turma.
- A **linha preta** marca razão = 1 (empate entre H₁ e H₂).

:::

::: {.callout-important appearance="default" icon="false"}

### **PERGUNTA 4** {-}

a) O valor do dado físico está dentro da região típica das simulações sob H₁? O que isso significa?

b) O valor do dado mental está dentro ou fora da região típica? O que isso indica sobre a necessidade de H₂?

c) Baseado neste histograma, você diria que os dados do dado mental foram gerados por um processo uniforme (H₁)?

:::

# Modelos a Priori

Explore como diferentes crenças iniciais (prioris) afetam a conclusão final (posteriori).

## A Priori da Turma

### *Código* {-}

```{r}
#| eval: false

# Inserir os valores REAIS da votação da turma
# (substituir pelos números do quadro)
n_turma <- 50
votos_H1 <- 32  # Quantos votaram em H₁
votos_H2 <- 18  # Quantos votaram em H₂

# Calcular a priori
prior_turma <- c(H1 = votos_H1 / n_turma, H2 = votos_H2 / n_turma)

print("Priori da Turma:")
round(prior_turma, 2)
```

## Calculando a Posteriori com Diferentes Prioris

### *Código* {-}

```{r}
#| eval: false

# Função auxiliar para calcular posteriori
calcular_posteriori <- function(prior, loglik_H1, loglik_H2) {
  lik <- c(H1 = exp(loglik_H1), H2 = exp(loglik_H2))
  post <- prior * lik
  post <- post / sum(post)
  return(post)
}

# Posteriori com priori da turma
post_turma_mental <- calcular_posteriori(prior_turma, 
                                         loglik_H1_mental, 
                                         loglik_H2_mental)

# Posteriori com priori 50/50 (sem preferência)
prior_neutro <- c(H1 = 0.5, H2 = 0.5)
post_neutro_mental <- calcular_posteriori(prior_neutro, 
                                          loglik_H1_mental, 
                                          loglik_H2_mental)

# Posteriori com priori 90/10 (forte preferência por H₁)
prior_forte_H1 <- c(H1 = 0.9, H2 = 0.1)
post_forte_H1_mental <- calcular_posteriori(prior_forte_H1, 
                                            loglik_H1_mental, 
                                            loglik_H2_mental)

# Posteriori com priori 10/90 (forte preferência por H₂)
prior_forte_H2 <- c(H1 = 0.1, H2 = 0.9)
post_forte_H2_mental <- calcular_posteriori(prior_forte_H2, 
                                            loglik_H1_mental, 
                                            loglik_H2_mental)

# Mostrar resultados
print("=== PRIORI DA TURMA ===")
print(round(prior_turma, 3))
print("Posteriori:")
print(round(post_turma_mental, 3))

print("=== PRIORI NEUTRO (50/50) ===")
print(round(prior_neutro, 3))
print("Posteriori:")
print(round(post_neutro_mental, 3))

print("=== PRIORI FORTE EM H₁ (90/10) ===")
print(round(prior_forte_H1, 3))
print("Posteriori:")
print(round(post_forte_H1_mental, 3))

print("=== PRIORI FORTE EM H₂ (10/90) ===")
print(round(prior_forte_H2, 3))
print("Posteriori:")
print(round(post_forte_H2_mental, 3))
```

## Visualizando a Atualização Bayesiana

### *Código* {-}

```{r}
#| eval: false

# Criar uma figura com 4 painéis
par(mfrow = c(2, 2))

# Painel 1: Priori e Posteriori da Turma
barplot(rbind(prior_turma, post_turma_mental), 
        beside = TRUE, 
        col = c("grey70", "salmon"),
        main = "Priori da Turma",
        ylab = "Probabilidade",
        ylim = c(0, 1),
        legend.text = c("Priori", "Posteriori"))

# Painel 2: Priori e Posteriori Neutro
barplot(rbind(prior_neutro, post_neutro_mental), 
        beside = TRUE, 
        col = c("grey70", "salmon"),
        main = "Priori Neutro (50/50)",
        ylab = "Probabilidade",
        ylim = c(0, 1),
        legend.text = c("Priori", "Posteriori"))

# Painel 3: Priori e Posteriori Forte em H₁
barplot(rbind(prior_forte_H1, post_forte_H1_mental), 
        beside = TRUE, 
        col = c("grey70", "salmon"),
        main = "Priori Forte em H₁ (90/10)",
        ylab = "Probabilidade",
        ylim = c(0, 1),
        legend.text = c("Priori", "Posteriori"))

# Painel 4: Priori e Posteriori Forte em H₂
barplot(rbind(prior_forte_H2, post_forte_H2_mental), 
        beside = TRUE, 
        col = c("grey70", "salmon"),
        main = "Priori Forte em H₂ (10/90)",
        ylab = "Probabilidade",
        ylim = c(0, 1),
        legend.text = c("Priori", "Posteriori"))
```

::: {.callout-tip appearance="minimal" title="O que observar"}

- Quatro gráficos mostrando como diferentes prioris levam a diferentes posterioris.
- Em cada gráfico, as barras cinzas são a **priori** (antes dos dados).
- As barras salmão são a **posteriori** (depois dos dados).
- Observe como a evidência dos dados "puxa" a crença em direção a H₂.

:::


::: {.callout-important appearance="default" icon="false"}

### **PERGUNTA 5** {-}

a) Em qual dos quatro cenários a priori teve **maior** influência na posteriori? Por quê?

b) Em qual cenário a priori teve **menor** influência? O que isso nos ensina sobre quando a priori importa mais ou menos?

c) Mesmo com uma priori muito forte em H₁ (90/10), a posteriori mudou em direção a H₂? O que isso indica sobre a força da evidência nos dados do dado mental?

:::

# Recapitulando as Etapas de Hoje

Conceitos fundamentais da inferência estatística/probabilística:

1. **Modelos probabilísticos**: Traduzir hipóteses em equações matemáticas com probabilidades.
2. **Verossimilhança**: Medir quão compatível um modelo é com os dados observados.
3. **Comparação de modelos**: Comparar a verossimilhança entre os modelos.
4. **Simulação**: Gerar dados para entender o que cada modelo pode prever.
5. **Inferência Bayesiana**: Atualizar as crenças combinando conhecimento prévio (priori) com evidências (dados).